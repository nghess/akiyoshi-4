<!DOCTYPE html>
<html>

<head>
  <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
  <script src="plugins/jspsych.js"></script>
  <script src="plugins/jspsych-fullscreen.js"></script>
  <script src="plugins/jspsych-call-function.js"></script>
  <script src="plugins/set-prompts.js"></script>
  <!--set prompts function-->
  <script src="plugins/prompt-list.js"></script>
  <script src="plugins/jspsych-external-html.js"></script>
  <script src="plugins/jspsych-html-button-response.js"></script>
  <script src="plugins/jspsych-survey-html-form.js"></script>
  <script src="plugins/jspsych-animation-akiyoshi3.js"></script>
  <!--anim slider plugin-->
  <script src="plugins/dynamic-fractals-akiyoshi3.js"></script>
  <!--lists from local images-->
  <script src="plugins/stimuli-list-akiyoshi3.js"></script>
  <script src="plugins/jspsych-preload.js"></script>
  <script src="plugins/preload-sequence.js"></script>
  <!--stimuli preload sequence-->
  <link rel="stylesheet" href="css/jspsych_ngh.css">
</head>

<body></body>
<script>
  /*grab screen resolution*/
  var screen_res = screen.width + "x" + screen.height;
  jsPsych.data.addProperties({ resolution: screen_res });

  /*Descriptor var for CSV*/
  var descriptor = ' ';

  /* create timeline */
  var timeline = [];

  /* fullscreen and timestamp functions */
  var fullscreen_enter = {
    type: 'fullscreen',
    message: 'Click the button below to begin the experiment.<br><br>',
    fullscreen_mode: true
  }
  var fullscreen_exit = {
    type: 'fullscreen',
    fullscreen_mode: false
  }
  var userID = {
    type: 'survey-html-form',
    preamble: '<p>Input Participant ID</p>',
    html: '<p><input type="text" id="test-resp-box" name="userID" size="10" /></p>',
    autofocus: 'test-resp-box'
  };

  var ageGender = {
    type: 'survey-html-form',
    preamble: '<p>Please input your age and gender identity:</p>',
    html: '<p>Age <input type="number" id="test-resp-box" name="age" style="width: 3em;" /></p><p>Gender <input type="text" id="test-resp-box" name="gender" size="10" /></p>',
    autofocus: 'test-resp-box'
  };

  /* consent and intro */
  var introduction = {
    type: 'html-button-response',
    stimulus: '<div style="max-width:600px;"><p>Use the slider to indicate how <strong>complex</strong> the animation looks</p></div>',
    choices: ['Continue']
  }

  /*debrief and thanks*/
  var debrief = {
    type: 'html-button-response',
    stimulus: debrief_text,
    button_delay: 0,
    choices: ['Continue']
  }
  var thanks = {
    type: 'html-button-response',
    stimulus: 'Thank you for participating in this study. <br>Please click below to finish the experiment and submit your responses.<br><br>',
    button_delay: 0,    
    choices: ['Exit']
  }

  /* block categories */
  var complexBlock_bw = {
    type: 'html-button-response',
    stimulus: complex_text_bw,
    choices: ['Continue'],
    button_delay: .4, 
  }

  var complexBlock_gs = {
    type: 'html-button-response',
    stimulus: complex_text_gs,
    choices: ['Continue'],
    button_delay: .4, 
  }

  /*block shuffler*/
  var block = [complexBlock_bw, appealingBlock];
  var prmpt = [complexPrompt_bw, complexPrompt_bw];
  /*trial shuffler*/
  var dyn_bw = [s117_b25_s1, s117_b25_s2, s117_b25_s3, s117_b25_s4, s117_b25_s5,
    s117_b35_s1, s117_b35_s2, s117_b35_s3, s117_b35_s4, s117_b35_s5,
    s117_b40_s1, s117_b40_s2, s117_b40_s3, s117_b40_s4, s117_b40_s5,
    s117_b45_s1, s117_b45_s2, s117_b45_s3, s117_b45_s4, s117_b45_s5,
    s117_b55_s1, s117_b55_s2, s117_b55_s3, s117_b55_s4, s117_b55_s5,
    s238_b25_s1, s238_b25_s2, s238_b25_s3, s238_b25_s4, s238_b25_s5,
    s238_b35_s1, s238_b35_s2, s238_b35_s3, s238_b35_s4, s238_b35_s5,
    s238_b40_s1, s238_b40_s2, s238_b40_s3, s238_b40_s4, s238_b40_s5,
    s238_b45_s1, s238_b45_s2, s238_b45_s3, s238_b45_s4, s238_b45_s5,
    s238_b55_s1, s238_b55_s2, s238_b55_s3, s238_b55_s4, s238_b55_s5,
    s314_b25_s1, s314_b25_s2, s314_b25_s3, s314_b25_s4, s314_b25_s5,
    s314_b35_s1, s314_b35_s2, s314_b35_s3, s314_b35_s4, s314_b35_s5,
    s314_b40_s1, s314_b40_s2, s314_b40_s3, s314_b40_s4, s314_b40_s5,
    s314_b45_s1, s314_b45_s2, s314_b45_s3, s314_b45_s4, s314_b45_s5,
    s314_b55_s1, s314_b55_s2, s314_b55_s3, s314_b55_s4, s314_b55_s5,];
  //Array = [1:75]
  var num = [...Array(75).keys()];
  var cnd = [0, 1];
  //Shufflers for Descriptors and Prompts
  blk = jsPsych.randomization.repeat(cnd, 1)
  //Shufflers for 75 trial lists
  n1 = jsPsych.randomization.repeat(num, 1)
  n2 = jsPsych.randomization.repeat(num, 1)


  //Save CSV PHP Function
  function saveData(data) {
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.send(JSON.stringify({ filedata: data }));
  }


  /*timeline*/
  jsPsych.init({
    //default_iti: 500,
    timeline: [//informed_consent,
      preload_1, preload_2, preload_3,
      //userID, 
      fullscreen_enter, ageGender,
      block[blk[0]], prmpt[blk[0]], //Complex block 1
      dyn_bw[n1[0]], dyn_bw[n1[1]], dyn_bw[n1[2]], dyn_bw[n1[3]], dyn_bw[n1[4]],
      dyn_bw[n1[5]], dyn_bw[n1[6]], dyn_bw[n1[7]], dyn_bw[n1[8]], dyn_bw[n1[9]],
      dyn_bw[n1[10]], dyn_bw[n1[11]], dyn_bw[n1[12]], dyn_bw[n1[13]], dyn_bw[n1[14]],
      dyn_bw[n1[15]], dyn_bw[n1[16]], dyn_bw[n1[17]], dyn_bw[n1[18]], dyn_bw[n1[19]],
      dyn_bw[n1[20]], dyn_bw[n1[21]], dyn_bw[n1[22]], dyn_bw[n1[23]], dyn_bw[n1[24]],
      dyn_bw[n1[25]], dyn_bw[n1[26]], dyn_bw[n1[27]], dyn_bw[n1[28]], dyn_bw[n1[29]],
      dyn_bw[n1[30]], dyn_bw[n1[31]], dyn_bw[n1[32]], dyn_bw[n1[33]], dyn_bw[n1[34]],
      dyn_bw[n1[35]], dyn_bw[n1[36]], dyn_bw[n1[37]], dyn_bw[n1[38]], dyn_bw[n1[39]],
      dyn_bw[n1[40]], dyn_bw[n1[41]], dyn_bw[n1[42]], dyn_bw[n1[43]], dyn_bw[n1[44]],
      dyn_bw[n1[45]], dyn_bw[n1[46]], dyn_bw[n1[47]], dyn_bw[n1[48]], dyn_bw[n1[49]],
      dyn_bw[n1[50]], dyn_bw[n1[51]], dyn_bw[n1[52]], dyn_bw[n1[53]], dyn_bw[n1[54]],
      dyn_bw[n1[55]], dyn_bw[n1[56]], dyn_bw[n1[57]], dyn_bw[n1[58]], dyn_bw[n1[59]],
      dyn_bw[n1[60]], dyn_bw[n1[61]], dyn_bw[n1[62]], dyn_bw[n1[63]], dyn_bw[n1[64]],
      dyn_bw[n1[65]], dyn_bw[n1[66]], dyn_bw[n1[67]], dyn_bw[n1[68]], dyn_bw[n1[69]],
      dyn_bw[n1[70]], dyn_bw[n1[71]], dyn_bw[n1[72]], dyn_bw[n1[73]], dyn_bw[n1[74]],  
      block[blk[1]], prmpt[blk[1]], //Complex block 2
      dyn_bw[n2[0]], dyn_bw[n2[1]], dyn_bw[n2[2]], dyn_bw[n2[3]], dyn_bw[n2[4]],
      dyn_bw[n2[5]], dyn_bw[n2[6]], dyn_bw[n2[7]], dyn_bw[n2[8]], dyn_bw[n2[9]],
      dyn_bw[n2[10]], dyn_bw[n2[11]], dyn_bw[n2[12]], dyn_bw[n2[13]], dyn_bw[n2[14]],
      dyn_bw[n2[15]], dyn_bw[n2[16]], dyn_bw[n2[17]], dyn_bw[n2[18]], dyn_bw[n2[19]],
      dyn_bw[n2[20]], dyn_bw[n2[21]], dyn_bw[n2[22]], dyn_bw[n2[23]], dyn_bw[n2[24]],
      dyn_bw[n2[25]], dyn_bw[n2[26]], dyn_bw[n2[27]], dyn_bw[n2[28]], dyn_bw[n2[29]],
      dyn_bw[n2[30]], dyn_bw[n2[31]], dyn_bw[n2[32]], dyn_bw[n2[33]], dyn_bw[n2[34]],
      dyn_bw[n2[35]], dyn_bw[n2[36]], dyn_bw[n2[37]], dyn_bw[n2[38]], dyn_bw[n2[39]],
      dyn_bw[n2[40]], dyn_bw[n2[41]], dyn_bw[n2[42]], dyn_bw[n2[43]], dyn_bw[n2[44]],
      dyn_bw[n2[45]], dyn_bw[n2[46]], dyn_bw[n2[47]], dyn_bw[n2[48]], dyn_bw[n2[49]],
      dyn_bw[n2[50]], dyn_bw[n2[51]], dyn_bw[n2[52]], dyn_bw[n2[53]], dyn_bw[n2[54]],
      dyn_bw[n2[55]], dyn_bw[n2[56]], dyn_bw[n2[57]], dyn_bw[n2[58]], dyn_bw[n2[59]],
      dyn_bw[n2[60]], dyn_bw[n2[61]], dyn_bw[n2[62]], dyn_bw[n2[63]], dyn_bw[n2[64]],
      dyn_bw[n2[65]], dyn_bw[n2[66]], dyn_bw[n2[67]], dyn_bw[n2[68]], dyn_bw[n2[69]],
      dyn_bw[n2[70]], dyn_bw[n2[71]], dyn_bw[n2[72]], dyn_bw[n2[73]], dyn_bw[n2[74]],  

      debrief, thanks, fullscreen_exit
      //pavlovia_finish
    ],
    override_safe_mode: true,
    on_finish: function () {
      // select all trials
      var all_data = jsPsych.data.get();
      //jsPsych.data.displayData('csv')
      saveData(all_data.csv());
    }
  });

</script>

</html>